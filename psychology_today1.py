from bs4 import BeautifulSoup
import pprint
import requests
import json
import collections
import time
import re
pp = pprint.PrettyPrinter(indent=4)

all_my_data = []

headers = {
    'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.121 Safari/537.36'
}

# therapist_alpha = re.compile("[a-z]")
url_list = ["https://www.psychologytoday.com/us/therapists/profile-listings/vermont/h", "https://www.psychologytoday.com/us/therapists/profile-listings/vermont/i", "https://www.psychologytoday.com/us/therapists/profile-listings/vermont/j", "https://www.psychologytoday.com/us/therapists/profile-listings/vermont/k", "https://www.psychologytoday.com/us/therapists/profile-listings/vermont/l", "https://www.psychologytoday.com/us/therapists/profile-listings/vermont/m", "https://www.psychologytoday.com/us/therapists/profile-listings/vermont/n", "https://www.psychologytoday.com/us/therapists/profile-listings/vermont/o", "https://www.psychologytoday.com/us/therapists/profile-listings/vermont/p", "https://www.psychologytoday.com/us/therapists/profile-listings/vermont/r", "https://www.psychologytoday.com/us/therapists/profile-listings/vermont/s", "https://www.psychologytoday.com/us/therapists/profile-listings/vermont/t", "https://www.psychologytoday.com/us/therapists/profile-listings/vermont/u", "https://www.psychologytoday.com/us/therapists/profile-listings/vermont/v", "https://www.psychologytoday.com/us/therapists/profile-listings/vermont/w", "https://www.psychologytoday.com/us/therapists/profile-listings/vermont/x", "https://www.psychologytoday.com/us/therapists/profile-listings/vermont/y", "https://www.psychologytoday.com/us/therapists/profile-listings/vermont/z", "https://www.psychologytoday.com/us/therapists/profile-listings/virginia/a", "https://www.psychologytoday.com/us/therapists/profile-listings/virginia/b", "https://www.psychologytoday.com/us/therapists/profile-listings/virginia/c", "https://www.psychologytoday.com/us/therapists/profile-listings/virginia/d", "https://www.psychologytoday.com/us/therapists/profile-listings/virginia/e", "https://www.psychologytoday.com/us/therapists/profile-listings/virginia/f", "https://www.psychologytoday.com/us/therapists/profile-listings/virginia/g", "https://www.psychologytoday.com/us/therapists/profile-listings/virginia/h", "https://www.psychologytoday.com/us/therapists/profile-listings/virginia/i", "https://www.psychologytoday.com/us/therapists/profile-listings/virginia/j", "https://www.psychologytoday.com/us/therapists/profile-listings/virginia/k", "https://www.psychologytoday.com/us/therapists/profile-listings/virginia/l", "https://www.psychologytoday.com/us/therapists/profile-listings/virginia/m", "https://www.psychologytoday.com/us/therapists/profile-listings/virginia/n", "https://www.psychologytoday.com/us/therapists/profile-listings/virginia/o", "https://www.psychologytoday.com/us/therapists/profile-listings/virginia/p", "https://www.psychologytoday.com/us/therapists/profile-listings/virginia/q", "https://www.psychologytoday.com/us/therapists/profile-listings/virginia/r", "https://www.psychologytoday.com/us/therapists/profile-listings/virginia/s", "https://www.psychologytoday.com/us/therapists/profile-listings/virginia/t", "https://www.psychologytoday.com/us/therapists/profile-listings/virginia/u", "https://www.psychologytoday.com/us/therapists/profile-listings/virginia/v", "https://www.psychologytoday.com/us/therapists/profile-listings/virginia/w", "https://www.psychologytoday.com/us/therapists/profile-listings/virginia/y", "https://www.psychologytoday.com/us/therapists/profile-listings/virginia/z", "https://www.psychologytoday.com/us/therapists/profile-listings/washington/a", "https://www.psychologytoday.com/us/therapists/profile-listings/washington/b", "https://www.psychologytoday.com/us/therapists/profile-listings/washington/c", "https://www.psychologytoday.com/us/therapists/profile-listings/washington/d", "https://www.psychologytoday.com/us/therapists/profile-listings/washington/e", "https://www.psychologytoday.com/us/therapists/profile-listings/washington/f", "https://www.psychologytoday.com/us/therapists/profile-listings/washington/g", "https://www.psychologytoday.com/us/therapists/profile-listings/washington/h", "https://www.psychologytoday.com/us/therapists/profile-listings/washington/i", "https://www.psychologytoday.com/us/therapists/profile-listings/washington/j", "https://www.psychologytoday.com/us/therapists/profile-listings/washington/k", "https://www.psychologytoday.com/us/therapists/profile-listings/washington/l", "https://www.psychologytoday.com/us/therapists/profile-listings/washington/m", "https://www.psychologytoday.com/us/therapists/profile-listings/washington/n", "https://www.psychologytoday.com/us/therapists/profile-listings/washington/o", "https://www.psychologytoday.com/us/therapists/profile-listings/washington/p", "https://www.psychologytoday.com/us/therapists/profile-listings/washington/q", "https://www.psychologytoday.com/us/therapists/profile-listings/washington/r", "https://www.psychologytoday.com/us/therapists/profile-listings/washington/s", "https://www.psychologytoday.com/us/therapists/profile-listings/washington/t", "https://www.psychologytoday.com/us/therapists/profile-listings/washington/u", "https://www.psychologytoday.com/us/therapists/profile-listings/washington/v", "https://www.psychologytoday.com/us/therapists/profile-listings/washington/w", "https://www.psychologytoday.com/us/therapists/profile-listings/washington/y", "https://www.psychologytoday.com/us/therapists/profile-listings/washington/z", "https://www.psychologytoday.com/us/therapists/profile-listings/west-virginia/a", "https://www.psychologytoday.com/us/therapists/profile-listings/west-virginia/b", "https://www.psychologytoday.com/us/therapists/profile-listings/west-virginia/c", "https://www.psychologytoday.com/us/therapists/profile-listings/west-virginia/d", "https://www.psychologytoday.com/us/therapists/profile-listings/west-virginia/e", "https://www.psychologytoday.com/us/therapists/profile-listings/west-virginia/f", "https://www.psychologytoday.com/us/therapists/profile-listings/west-virginia/g", "https://www.psychologytoday.com/us/therapists/profile-listings/west-virginia/h", "https://www.psychologytoday.com/us/therapists/profile-listings/west-virginia/k", "https://www.psychologytoday.com/us/therapists/profile-listings/west-virginia/l", "https://www.psychologytoday.com/us/therapists/profile-listings/west-virginia/m", "https://www.psychologytoday.com/us/therapists/profile-listings/west-virginia/n", "https://www.psychologytoday.com/us/therapists/profile-listings/west-virginia/o", "https://www.psychologytoday.com/us/therapists/profile-listings/west-virginia/p", "https://www.psychologytoday.com/us/therapists/profile-listings/west-virginia/r", "https://www.psychologytoday.com/us/therapists/profile-listings/west-virginia/s", "https://www.psychologytoday.com/us/therapists/profile-listings/west-virginia/t", "https://www.psychologytoday.com/us/therapists/profile-listings/west-virginia/v", "https://www.psychologytoday.com/us/therapists/profile-listings/west-virginia/w", "https://www.psychologytoday.com/us/therapists/profile-listings/west-virginia/y", "https://www.psychologytoday.com/us/therapists/profile-listings/west-virginia/z", "https://www.psychologytoday.com/us/therapists/profile-listings/wisconsin/a", "https://www.psychologytoday.com/us/therapists/profile-listings/wisconsin/b", "https://www.psychologytoday.com/us/therapists/profile-listings/wisconsin/c", "https://www.psychologytoday.com/us/therapists/profile-listings/wisconsin/d", "https://www.psychologytoday.com/us/therapists/profile-listings/wisconsin/e", "https://www.psychologytoday.com/us/therapists/profile-listings/wisconsin/f", "https://www.psychologytoday.com/us/therapists/profile-listings/wisconsin/g", "https://www.psychologytoday.com/us/therapists/profile-listings/wisconsin/h", "https://www.psychologytoday.com/us/therapists/profile-listings/wisconsin/i", "https://www.psychologytoday.com/us/therapists/profile-listings/wisconsin/j", "https://www.psychologytoday.com/us/therapists/profile-listings/wisconsin/k", "https://www.psychologytoday.com/us/therapists/profile-listings/wisconsin/l", "https://www.psychologytoday.com/us/therapists/profile-listings/wisconsin/m", "https://www.psychologytoday.com/us/therapists/profile-listings/wisconsin/n", "https://www.psychologytoday.com/us/therapists/profile-listings/wisconsin/o", "https://www.psychologytoday.com/us/therapists/profile-listings/wisconsin/p", "https://www.psychologytoday.com/us/therapists/profile-listings/wisconsin/r", "https://www.psychologytoday.com/us/therapists/profile-listings/wisconsin/s", "https://www.psychologytoday.com/us/therapists/profile-listings/wisconsin/t", "https://www.psychologytoday.com/us/therapists/profile-listings/wisconsin/v", "https://www.psychologytoday.com/us/therapists/profile-listings/wisconsin/w", "https://www.psychologytoday.com/us/therapists/profile-listings/wisconsin/y", "https://www.psychologytoday.com/us/therapists/profile-listings/wisconsin/z", "https://www.psychologytoday.com/us/therapists/profile-listings/wyoming/a", "https://www.psychologytoday.com/us/therapists/profile-listings/wyoming/b", "https://www.psychologytoday.com/us/therapists/profile-listings/wyoming/c", "https://www.psychologytoday.com/us/therapists/profile-listings/wyoming/d", "https://www.psychologytoday.com/us/therapists/profile-listings/wyoming/e", "https://www.psychologytoday.com/us/therapists/profile-listings/wyoming/f", "https://www.psychologytoday.com/us/therapists/profile-listings/wyoming/g", "https://www.psychologytoday.com/us/therapists/profile-listings/wyoming/h", "https://www.psychologytoday.com/us/therapists/profile-listings/wyoming/j", "https://www.psychologytoday.com/us/therapists/profile-listings/wyoming/k", "https://www.psychologytoday.com/us/therapists/profile-listings/wyoming/l", "https://www.psychologytoday.com/us/therapists/profile-listings/wyoming/m", "https://www.psychologytoday.com/us/therapists/profile-listings/wyoming/n", "https://www.psychologytoday.com/us/therapists/profile-listings/wyoming/p", "https://www.psychologytoday.com/us/therapists/profile-listings/wyoming/r", "https://www.psychologytoday.com/us/therapists/profile-listings/wyoming/s", "https://www.psychologytoday.com/us/therapists/profile-listings/wyoming/t", "https://www.psychologytoday.com/us/therapists/profile-listings/wyoming/v", "https://www.psychologytoday.com/us/therapists/profile-listings/wyoming/w"]

for link in url_list:

    headers = {
        'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.121 Safari/537.36'
    }

    r = requests.get(link, headers=headers)
    html_content = r.text
    soup = BeautifulSoup(html_content, 'html.parser')

    #pull all listing profiles in a letter category
    all_prof = soup.find_all("div", attrs = {'class':'col-9 col-sm-9 col-md-10 col-lg-10 col-xl-10 col-tight-left'})

    for prof in all_prof:
        proflink = prof.find('a')
        profurl = proflink['href']

        headers = {
            'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.121 Safari/537.36'
        }
        prof_request = requests.get(profurl, headers=headers)
        prof_html = prof_request.text
        prof_soup = BeautifulSoup(prof_html, "html.parser")

        address = prof_soup.find("div", attrs = {'itemprop' : 'address'})
        time.sleep(1)
        alabama_address = {}
        alabama_address["address"] = address.text
        alabama_address["url"] = profurl
        all_my_data.append(alabama_address)
        json_file = open('therapists7.json','w')
        json.dump(all_my_data,json_file, indent=2)
        json_file.close()
